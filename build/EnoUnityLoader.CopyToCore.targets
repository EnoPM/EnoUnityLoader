<?xml version="1.0" encoding="utf-8"?>
<!--
  Target pour copier les assemblies vers le dossier core du ModLoader.
  Ce fichier peut être importé séparément des props pour les projets
  qui ont leur propre configuration de build (ex: MonoMod).

  Usage:
  <Import Project="$(MSBuildThisFileDirectory)..\..\build\EnoModLoader.CopyToCore.targets" />
-->
<Project>

  <PropertyGroup>
    <!-- Lire ModLoaderOutputPath depuis Directory.Build.props à la racine -->
    <ModLoaderOutputPath Condition="'$(ModLoaderOutputPath)' == ''">$(MSBuildThisFileDirectory)..\output\ModLoader</ModLoaderOutputPath>
    <CoreOutputPath Condition="'$(CoreOutputPath)' == ''">$(ModLoaderOutputPath)\core</CoreOutputPath>
    <CopyToModLoaderCore Condition="'$(CopyToModLoaderCore)' == ''">true</CopyToModLoaderCore>
    <CopyAllDependenciesToCore Condition="'$(CopyAllDependenciesToCore)' == ''">false</CopyAllDependenciesToCore>
  </PropertyGroup>

  <!--
    Copy DLL to core folder after build.
  -->
  <Target Name="CopyToCore" AfterTargets="Build" Condition="'$(CopyToModLoaderCore)' == 'true' and '$(CopyAllDependenciesToCore)' != 'true'">
    <MakeDir Directories="$(CoreOutputPath)" Condition="!Exists('$(CoreOutputPath)')" />
    <Copy SourceFiles="$(TargetPath)" DestinationFolder="$(CoreOutputPath)" SkipUnchangedFiles="true" />
    <Message Importance="High" Text="Copied $(TargetFileName) to $(CoreOutputPath)" />
  </Target>

  <!--
    Copy all DLLs (including dependencies) to core folder.
    Use CopyAllDependenciesToCore=true on the main project (EnoModLoader).
  -->
  <Target Name="CopyAllToCore" AfterTargets="Build" Condition="'$(CopyAllDependenciesToCore)' == 'true'">
    <MakeDir Directories="$(CoreOutputPath)" Condition="!Exists('$(CoreOutputPath)')" />
    <ItemGroup>
      <DllsToCopy Include="$(TargetDir)*.dll" />
    </ItemGroup>
    <Copy SourceFiles="@(DllsToCopy)" DestinationFolder="$(CoreOutputPath)" SkipUnchangedFiles="true" />
    <Message Importance="High" Text="Copied @(DllsToCopy->Count()) DLLs to $(CoreOutputPath)" />
  </Target>

</Project>
